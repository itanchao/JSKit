<!DOCTYPE html>
<html>
  <head>
  	<meta charset="utf-8" />
    <title>iOS and Js</title>
    <style type="text/css">
      * {
        font-size: 40px;
      }
    </style>
  </head>
  <body>
    
    <div style="margin-top: 100px">
      <div><input type="button" value="点我试一试" onclick="openBluetoothAdapter()"></div><br/>
      <br/>
      <div id="SwiftDiv">
          <span id="jsParamFuncSpan" style="color: red; font-size: 50px;"></span>
      </div>
      
    </div>
    
    <script type="text/javascript">
        
        
    // 锁token
    var token = "";
    // 锁程序版本号
    var lockVersion = "";
    var lockType = "1";
    var lockSn = "00300326528";
    var uuidStr = "fa0c2c5964234565b6430f05bf49dcf2";
    
    // 1、扫码得SN去服务器请求锁信息
    var webReqestMac = 'c8:fd:19:8e:10:e1';
    var tokenEncData = "B89534BF8ED61D0442384D93B368CDDD,3D603D31165E034B24141E290908305A";
    
    
    // 2、启动蓝牙
    function openBluetoothAdapter() {
        JSBridge.callNativeFunc('openBluetoothAdapter',{'mac':webReqestMac, 'services':['0000fee7-0000-1000-8000-00805f9b34fb']},{
                                       success:function(res){
                                        alert(res)
                                           if (!res.isSupportBLE) {
                                                alert("您的手机系统不支持蓝牙！");
                                           }else{
                                                alert("您的手机系统支持蓝牙！");
                                       // 3、开始扫描
                                       startBluetoothDevicesDiscovery();
                                           }
                                       }, fail: function(res) {
                                           // 蓝牙打开失败，返回失败原因
                                           if (res.error == 12) {
                                                alert("蓝牙未打开");
                                           } else if (res.error == 13) {
                                                alert("蓝牙于系统服务的连接暂时丢失");
                                           } else if (res.error == 14) {
                                                alert("未授权使用蓝牙功能");
                                           } 
                                       }
                                  });
    }
    
    // *************************************************************************
    
    
    // 生成UUID
    function getUuid() {
        var s = [];
        var hexDigits = "0123456789abcdef";
        for (var i = 0; i < 36; i++) {
            s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
        }
        s[14] = "4";  // bits 12-15 of the time_hi_and_version field to 0010
        s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01
        s[8] = s[13] = s[18] = s[23] = "-";
        
        var uuid = s.join("");
        return uuid;
    }
    
    // 解密
    function decrypt(data, key) {
        
        var decrypt = decryptBleData(data, key);
        
        return decrypt;//hexStr2Bytes(decrypt);
    }
    
    //字节数组转十六进制字符串
    function bytes2HexStr(arr) {
        var str = "";
        for(var i=0; i<arr.length; i++) {
            var tmp = arr[i].toString(16);
            if(tmp.length == 1) {
                tmp = "0" + tmp;
            }
            str += tmp;
        }
        return str;
    }
    
    // 将hexString convert to bytes...
    function hexStr2Bytes(str) {
        var pos = 0;
        var len = str.length;
        if(len %2 != 0) {
            return null;
        }
        len /= 2;
        var hexA = new Array();
        for(var i=0; i<len; i++) {
            var s = str.substr(pos, 2);
            var v = parseInt(s, 16);
            hexA.push(v);
            pos += 2;
        }
        return hexA;
    }
    
    /**字符串转byte数组->"1,2,3" [1, 2, 3]
     */
    function getByte4Str(byteStr) {
        var byteStrArr = byteStr.split(",");
        var bytes = [];
        for (var i = 0; i < byteStrArr.length; i++) {
            bytes[i] = parseInt(byteStrArr[i]);
        }
        return bytes;
    }
    
    
    
    
    
    
    

      </script>
  </body>
</html>
